## 스핀락, 세마포어, 뮤텍스(Spinlock, Semaphore, Mutex)

멀티 코어 시스템에서는 여러 프로세스가 동시에 실행되어 시스템의 성능 향상을 목표로 한다.

이러한 환경에서 하나의 공유 자원을 한 프로세스가 사용중일 때, 다른 프로세스가 동시에 사용하려고 하면 여러 문제가 발생한다. 

서로 같은 값을 변경하려고 하거나 읽는 도중에 값이 바뀌어 오류가 생길 수도 있다. 이러한 문제들을 동기화 문제라고 하며 이렇게 동시에 사용될 수 있는 자원을 임계 영역이라고 한다

---

Critical Section (임계 영역)
임계 영역이란 프로세스 간의 공유 자원을 접근하는 데 있어서 문제가 발생하지 않도록 한 번에 하나의 프로세스만 이용하도록 다른 프로세스의 접근을 제한하는 영역을 말한다.

- 상호 배제 (Mutual Exclution)
하나의 프로세스가 임계 영역에서 실행중이라면, 다른 프로세스는 해당 영역에 접근할 수 없어야 한다.
- 실행 (Process)
임계 영역에서 실행중인 프로세스가 없을 때 들어가려는 프로세스가 여러 개라면 현재 대기중인 프로세스만이 진입 후보가 될 수 있고, 어느 것이 들어갈 것이지 결정해주어야 한다.
- 한정된 대기 (Bounded Waiting)
한 프로세스가 임계 영역에 진입 요청 후 받아들여질 때 까지의 시간동안 다른 프로세스들이 임계 영역에 진입하는 횟수는 제한이 있어야 한다.
다른 프로세스들의 기아(Starvation)을 막기 위함이다.


### 스핀락(Spin lock)

임계영역이 락이 걸려서 진입이 불가능할 때, 임계영역이 언락되어 진입이 가능해질 때까지 루프를 돌면서 재시도하여 스레드가 CPU를 점유하고 있는 상태이다.
CPU를 점유하여 무의미한 코드를 계속 수행하면서 임계영역이 언락되길 기다리는 것이기 때문에 스핀락은 Busy Waiting 상태이다.

스핀락은 운영체제의 스케줄링 지원을 받지 않기 때문에, 해당 스레드에 대한 문맥 교환(context switch)이 일어나지 않는다.

임계영역이 짧은 시간 안에 언락되어 진입이 가능한 상태이면 context switch 비용이 들지 않아 효율적일 수 있지만, 임계영역이 오랜 시간동안 언락되지 않으면 그 시간동안 계속 CPU를 점유하고 있어 다른 스레드가 사용하지 못하기 때문에 오버헤드도 존재한다.

스핀락은 context switch가 일어나지 않기 때문에 멀티 프로세서 시스템에서만 사용 가능하다.

Busy-wait: 어떤 조건이 충족될 때까지 반복적으로 검사를 수행하는 것을 의미

코드 및 설명 참조: https://s7won.tistory.com/12


### 뮤텍스

Mutex는 Mutual Exclusion의 약자로서 상호 배제라고도 한다. 뮤텍스는 상태가 오직 획득(Lock) / 해제(Unlock)만 존재한다는 점은 스핀락과 동일하다. 하지만 스핀락이 임계영역이 언락되어 권한을 획득하기까지 Busy Waiting 상태를 유지한다면, 뮤텍스는 Sleep 상태로 들어갔다 Wakeup 되면 다시 권한 획득을 시도한다.

뮤텍스의 경우에는 Locking 메커니즘으로 락을 걸은 스레드만이 임계영역을 나갈 때 락을 해제할 수 있습니다.

시스템 전반의 성능에 영향을 주고 싶지 않고 길게 처리해야하는 작업인 경우에 주로 사용된다. 주로 스레드 작업에서 많이 사용된다.


### 세마포어

스핀락과 뮤택스와 달리 표현형이 정수형이다. 이 점을 살려 하나 이상의 컴포넌트가 공유자원에 접근할 수 있도록 허용할 수 있다.

컴포넌트가 특정 자원에 접근할 때 semWait이 먼저 호출되어 임계영역에 들어갈 수 있는지 먼저 확인한다. 임계영역에 접근이 가능하다면 semWait을 빠져나와 임계영역에 들어가고, 이후 semSignal이 호출되어 임계영역에서 빠져나온다.


- 정수 변수를 사용하여 임계 영역에 접근한다.
- 세마포어 값이 0 이상이면 접근을 허용하고, 0 미만이면 대기한다.
- 세마포어 값은 P(임계 영역에 진입)와 V(임계 영역에서 나감) 연산으로 조절된다.
- 세마포어는 뮤텍스와 달리 여러 개의 스레드가 동시에 접근할 수 있다.
- 세마포어는 자원의 개수를 나타내기도 하며, 이를 활용하여 상호 배제, 동기화 등 다양한 동작을 구현할 수 있다.

*세마포어 종류*


바이너리 세마포어는 상호 배타적이며 0과 1의 두 값만 가질 수 있으며 1로 초기화된다. 여러 프로세스를 처리할 때 신호를 보내고 솔루션을 제공하는 데 사용된다.

카운팅 세마포어에는 상호 배제가 없으며 여러 인스턴스가 있는 리소스에 대한 액세스를 제어하는 ​​데 도움이 된다


